<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Mobile iframe Preview</title>
		<script>
			function qsa(selector, context = null) {
				return Array.from(
					(context ?? document)?.querySelectorAll(selector) || [],
				);
			}
		</script>
		<link rel="stylesheet" href="./reboot.css" />
		<style>
			body {
				min-height: 100vh;
				display: flex;
				flex-direction: column;
				align-items: center;
				background: var(--bs-gray-400);
			}

			#preview {
				flex: 1;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				min-height: 400px;
			}

			#size-label {
				text-align: center;
				padding-top: 1.5rem;
				font-size: 0.9em;
				font-family: var(--bs-font-monospace);
				color: var(--bs-gray);
			}
			iframe {
				border: none;
				border-radius: 24px;
				background: white;
				display: block;
				outline: 12px solid black;
				box-shadow: 0 5px 15px 10px rgba(0 0 0 / 0.8);
				transition: all 0.25s ease-in-out;
			}

			#controls {
				padding: 1rem;
				display: flex;
				gap: 1rem;
			}

			button {
				border-radius: 0.25rem;
				border: 0;
				font-size: 0.9rem;
			}

			button:hover,
			button.active {
				background-color: var(--bs-black);
				color: var(--bs-white);
			}

			.x {
				position: fixed;
				right: 0;
				top: 0;
				padding: 12px 16px;
				line-height: 1;
				text-decoration: none;
				font-size: 1.5rem;
				color: var(--bs-gray);
			}
			.x:hover {
				color: var(--bs-black);
			}
		</style>
	</head>
	<body>
		<!-- <a href="./" class="x">✕</a> -->

		<div id="preview">
			<iframe width="390" height="844"></iframe>
			<div id="size-label"></div>
		</div>

		<div id="controls">
			<button data-size="360x800">Android</button>
			<button data-size="390x844">iPhone 14</button>
			<button data-size="375x667">iPhone SE</button>
			<button onclick="reloadCurrentIframeUrl()" title="Reload">↻</button>
			<button onclick="promptUrl()" title="Set url">→</button>
		</div>

		<input type="hidden" name="iframe-url" value="./placeholder.html" />
		<input type="hidden" name="size" value="360x800" />

		<script>
			// poor man's reactive state source
			const urlInput = qsa("input[name=iframe-url]")[0];
			const sizeInput = qsa("input[name=size]")[0];

			//
			const buttons = qsa("button[data-size]");
			const iframe = qsa("iframe")[0];
			const sizeLabel = qsa("#size-label")[0];

			//
			sizeInput.addEventListener("change", render);
			urlInput.addEventListener("change", loadUrl);

			//
			buttons.forEach((button) => {
				button.addEventListener("click", (e) => {
					sizeInput.value = button.dataset.size;
					sizeInput.dispatchEvent(new Event("change"));
				});
			});

			// kick off
			render();
			loadUrl();

			//

			function render() {
				const [width, height] = sizeInput.value.split("x");
				iframe.width = width;
				iframe.height = height;
				sizeLabel.textContent = `${width} × ${height}`;
				//
				buttons.forEach((btn) => btn.classList.remove("active"));
				qsa(`button[data-size="${width}x${height}"]`).forEach((btn) => {
					btn.classList.add("active");
				});
			}

			function loadUrl() {
				iframe.src = urlInput.value.trim();
			}

			function setUrl(value) {
				if (value) {
					urlInput.value = value;
					urlInput.dispatchEvent(new Event("change"));
				}
			}

			function promptUrl() {
				setUrl(prompt("Go to URL", "http://"));
			}

			function reloadCurrentIframeUrl() {
				try {
					// throws if cross-origin
					iframe.contentWindow.location.reload();
				} catch (e) {
					// so we can only reload the initial src
					loadUrl();
				}
			}
		</script>
	</body>
</html>
